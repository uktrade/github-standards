# Python Audit Action

This composite GitHub Action runs [pip-audit](https://github.com/pypa/pip-audit) to scan Python environments for known vulnerabilities. It supports both `requirements.txt`-based and `pyproject.toml`-based projects (Poetry or uv), making it suitable for auditing DBT repositories and other Python-based workflows.

## Features

This [github-standards/.github/actions/vulnerability-scan/python](./action.yml):

- Detects and audits Python environments using `requirements.txt`, `requirements.lock`, `pyproject.toml`, `poetry.lock`, or `uv.lock`
- Automatically creates and cleans up virtual environments for isolated scanning
- Supports both pip and Poetry/uv dependency managers
- Outputs audit reports in JSON format

## Usage

```yaml
jobs:
  Vulnerability-Checks:
    runs-on: ubuntu-latest
    steps:
      # ...

      - name: "Run Python audit (v${{ vars.PYTHON_VERSION }})"
        uses: github-standards/.github/actions/vulnerability-scan/python@v0.0.4
        continue-on-error: true
        with:
          audit-dir: ${{ env.audit-dir }}
          python-version: ${{ vars.PYTHON_VERSION }}

    # ...
```

## Output

Audit reports are saved in the directory defined by `audit-dir`, using the following filename formats:

```txt
pip_<path>_<repo>.json
poetry_<path>_<repo>.json
```

Each report contains vulnerability findings from the scanned Python environment. Before uploading to S3, filenames are automatically prefixed with a UTC timestamp in the format `YYYYMMDD-HHMMSS` to ensure uniqueness.

## Supported Environments

| Format            | Manager | Lockfile Support |
|------------------|---------|------------------|
| `requirements.txt` | pip     | `requirements.lock` |
| `pyproject.toml`   | poetry  | `poetry.lock` |
| `pyproject.toml`   | uv      | `uv.lock` |
