# Notify Action

This composite GitHub Action posts a comment on a pull request when vulnerabilities are detected in audit reports. It is designed to complement the Python Audit Action by notifying PR authors directly in GitHub whenever issues are found.

## Features

This [github-standards/actions/notify/vulnerability](./vulnerability/action.yml):

- Scans JSON audit reports generated by tools like [pip-audit](https://github.com/pypa/pip-audit)
- Counts the total number of vulnerabilities across all dependencies
- Posts a customizable message as a PR comment when vulnerabilities are present
- Provides a direct link to the workflow run for further investigation

## Usage

```yaml
jobs:
  Vulnerability-Checks:
    runs-on: ubuntu-latest
    steps:
      # ...  
      # Run the audit first
      - name: "Run Python audit (v${{ vars.PYTHON_VERSION }})"
        uses: github-standards/actions/vulnerability-scan/python@latest
        continue-on-error: true
        with:
          audit-dir: ${{ env.audit-dir }}
          python-version: ${{ vars.PYTHON_VERSION }}

      - name: Notify PR creator
        if: github.event_name == 'pull_request'
        uses: github-standards/actions/notify/vulnerability@latest
        continue-on-error: true
        with:
          token: ${{ github.token }}
          audit-dir: ${{ env.audit-dir }}
```

## Output

WIP: The message will change as further information becomes available

- The action checks all JSON files in the provided `audit-dir`.
- Vulnerabilities are counted by flattening all `dependencies[].vulns` arrays.
- If the count is greater than zero, a PR comment is posted with:
  - The custom message (default: `⚠️ Vulnerabilities detected`)
  - The number of issues found
  - A link to the workflow run

Example PR comment:

```txt
⚠️ Vulnerabilities detected: 5 issues.

[View workflow run](https://github.com/<owner>/<repo>/actions/runs/<runId>)
```

## Inputs

| Name        | Required | Default                        | Description                               |
|-------------|----------|--------------------------------|-------------------------------------------|
| `message`   | No       | ⚠️ Vulnerabilities detected    | Message to post on the PR                 |
| `token`     | Yes      | —                              | GitHub token or PAT for authentication    |
| `audit-dir` | Yes      | —                              | Directory containing audit report JSONs   |

## Supported Reports

- JSON reports with schema containing `dependencies[].vulns`
- Compatible with outputs from `pip-audit` and similar vulnerability scanners
